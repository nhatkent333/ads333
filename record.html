<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Record Chrome Tab - Full HD, No Cursor</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    video { width: 100%; background: #000; margin-top: 10px; }
    button { padding: 8px 14px; margin: 4px; }
  </style>
</head>
<body>
  <h2>Ghi lại Chrome Tab (Full HD, không có trỏ chuột)</h2>

  <button id="btnShare">Chia sẻ tab</button>
  <button id="btnStart" disabled>Bắt đầu ghi</button>
  <button id="btnStop" disabled>Dừng ghi</button>
  <button id="btnDownload" disabled>Tải video</button>
  <p>Status: <span id="status">idle</span></p>

  <video id="preview" autoplay playsinline muted></video>

  <script>
    const btnShare = document.getElementById("btnShare");
    const btnStart = document.getElementById("btnStart");
    const btnStop = document.getElementById("btnStop");
    const btnDownload = document.getElementById("btnDownload");
    const statusEl = document.getElementById("status");
    const preview = document.getElementById("preview");

    let stream, mediaRecorder, chunks = [], recordedBlob;

    btnShare.onclick = async () => {
      try {
        stream = await navigator.mediaDevices.getDisplayMedia({
          video: {
            cursor: "never", // ✅ không ghi trỏ chuột
            width: { ideal: 1920 },
            height: { ideal: 1080 },
            frameRate: { ideal: 60 }
          },
          audio: true
        });

        preview.srcObject = stream;
        preview.muted = true;
        btnStart.disabled = false;
        setStatus("ready");
      } catch (err) {
        console.error(err);
        setStatus("error: " + err.message);
      }
    };

    btnStart.onclick = () => {
      chunks = [];
      mediaRecorder = new MediaRecorder(stream, {
        mimeType: "video/webm;codecs=vp9,opus",
        videoBitsPerSecond: 8000000 // ✅ bitrate cao để giữ chất lượng
      });

      mediaRecorder.ondataavailable = e => e.data.size && chunks.push(e.data);
      mediaRecorder.onstop = () => {
        recordedBlob = new Blob(chunks, { type: "video/webm" });
        btnDownload.disabled = false;
        setStatus("stopped");
      };

      mediaRecorder.start(1000);
      btnStart.disabled = true;
      btnStop.disabled = false;
      setStatus("recording...");
    };

    btnStop.onclick = () => {
      mediaRecorder.stop();
      btnStop.disabled = true;
      btnStart.disabled = false;
    };

    btnDownload.onclick = () => {
      const url = URL.createObjectURL(recordedBlob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "chrome-tab-fullhd.webm";
      a.click();
      URL.revokeObjectURL(url);
    };

    function setStatus(s) { statusEl.textContent = s; }
  </script>
</body>
</html>
